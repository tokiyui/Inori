fetch('song.json')
    .then(response => response.json())
    .then(songs => {
        fetch('CD.json')
            .then(response => response.json())
            .then(CDs => {
                const songTable = document.getElementById('songTable');

                songs.forEach(song => {
                    song.CDtitle.forEach(cdTitle => {
                        const matchingCD = CDs.find(cd => cd.CDtitle === cdTitle);

                        if (matchingCD) {
                            const formattedDate = new Date(matchingCD.date).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });

                            const row = `
                                <tr>
                                    <td>${song.title}</td>
                                    <td>${song.lyrics}</td>
                                    <td>${song.music}</td>
                                    <td>${song.arranger}</td>
                                    <td>${cdTitle}</td>
                                    <td>${formattedDate}</td>
                                </tr>
                            `;
                            songTable.innerHTML += row;
                        } else {
                            const row = `
                                <tr>
                                    <td>${song.title}</td>
                                    <td>${song.lyrics}</td>
                                    <td>${song.music}</td>
                                    <td>${song.arranger}</td>
                                    <td>${cdTitle}</td>
                                    <td>No release date found</td>
                                </tr>
                            `;
                            songTable.innerHTML += row;
                        }
                    });
                });
            })
            .catch(error => console.error('Failed to fetch CD data:', error));
    })
    .catch(error => console.error('Failed to fetch song data:', error));
