<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIVE Information</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
</style>
</head>
<body>
<div id="liveInfo"></div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const targetLiveId = urlParams.get('id');

if (!targetLiveId) {
    document.getElementById('liveInfo').innerHTML = '<p>No ID provided in the query parameters.</p>';
} else {
    const jsonFiles = [];

    // ファイル名が20**.jsonのファイルを取得
    for (let i = 2000; i < 2100; i++) {
        const fileName = `${i.toString().padStart(4, '0')}_live_data.json`;
        jsonFiles.push(fileName);
    }

    let found = false;

    // 各JSONファイルを順番に読み込み、IDが一致するライブ情報を表示
    const loadLiveInfo = async () => {
        for (const file of jsonFiles) {
            try {
                const response = await fetch(file);
                const data = await response.json();
                const liveData = data.find(item => item.id === targetLiveId);

                if (liveData) {
                    const liveInfo = document.getElementById('liveInfo');

                    const getDayOfWeek = dateString => {
                        const days = ['日', '月', '火', '水', '木', '金', '土'];
                        const date = new Date(dateString.replace(/年|月|日/g, '/'));
                        return days[date.getDay()];
                    };

                    const renderSetlist = setlist => {
                        let setlistHTML = '<ul>';
                        setlist.forEach((song, index) => {
                            setlistHTML += `<li>${index + 1}. ${song}</li>`;
                        });
                        setlistHTML += '</ul>';
                        return setlistHTML;
                    };

                    const renderEncore = encore => {
                        if (!encore || encore.length === 0) {
                            return '';
                        }
                        let encoreHTML = '<ul>';
                        encore.forEach((song, index) => {
                            encoreHTML += `<li>${index + 1}. ${song}</li>`;
                        });
                        encoreHTML += '</ul>';
                        return encoreHTML;
                    };

                    const html = `
                        <h1>${liveData.LIVEtitle}</h1>
                        <p>Date: ${liveData.date} (${getDayOfWeek(liveData.date)})</p>
                        <p>Venue: ${liveData.venue}</p>
                        <h2>Setlist</h2>
                        ${renderSetlist(liveData.setlist)}
                        ${liveData.encore && liveData.encore.length > 0 ? `<h2>Encore</h2>${renderEncore(liveData.encore)}` : ''}
                        ${liveData.Wencore ? `<h2>Wencore</h2><p>${liveData.Wencore}</p>` : ''}
                    `;
                    liveInfo.innerHTML = html;

                    found = true;
                    break;
                }
            } catch (error) {
                console.error(`Error fetching data from ${file}:`, error);
            }
        }

        if (!found) {
            document.getElementById('liveInfo').innerHTML = '<p>No live information found for the provided ID.</p>';
        }
    };

    loadLiveInfo();
}
</script>
</body>
</html>
