<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setlist Analysis</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
</style>
</head>
<body>
<div id="result"></div>

<script>
function loadJSON(url, callback) {
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', url, true);
    xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
            callback(JSON.parse(xobj.responseText));
        }
    };
    xobj.send(null);
}

function parseQueryString(url) {
    var params = {};
    var parser = document.createElement('a');
    parser.href = url;
    var query = parser.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
    }
    return params;
}

function searchSetlist() {
    const url = window.location.href;
    const queryParams = parseQueryString(url);
    const name = queryParams.name;

    loadJSON('setlist.json', function(data) {
        const liveData = data.find(item => item.name === name);

        if (!liveData) {
            document.getElementById('result').innerHTML = '<p>No live information found for the provided name.</p>';
            return;
        }

        const setlistCount = liveData.setlist.length;
        const encoreCount = liveData.encore.length;
        const wEncoreCount = liveData.Wencore.split(" ").length;

        let maxIdDate = liveData.date.substring(0, 8);

        // Display the results
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `
            <p>Number of songs in setlist: ${setlistCount}</p>
            <p>Number of songs in encore: ${encoreCount}</p>
            <p>Number of words in Wencore: ${wEncoreCount}</p>
            <p>Date with maximum ID: ${maxIdDate}</p>
        `;
    });
}

// Call searchSetlist function on page load
searchSetlist();
</script>
</body>
</html>
